<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Steam Review Sentiment Analysis Demo</title>
    <style>
        body { 
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; 
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); 
            padding: 20px; 
        }
        .container { 
            max-width: 1200px; 
            margin: 0 auto; 
            background: white; 
            border-radius: 20px; 
            box-shadow: 0 25px 50px rgba(0,0,0,0.15); 
            overflow: hidden; 
        }
        .header { 
            background: linear-gradient(135deg, #2c3e50 0%, #3498db 100%); 
            color: white; 
            padding: 40px; 
            text-align: center; 
            position: relative; 
            overflow: hidden; 
        }
        h1, h2, h3, h4 { 
            margin-bottom: 15px; 
        }
        .review-card { 
            background: white; 
            border-radius: 15px; 
            padding: 25px; 
            box-shadow: 0 8px 25px rgba(0,0,0,0.1); 
            border-left: 5px solid #3498db; 
            margin-bottom: 20px; 
        }
        .review-card.positive { border-left-color: #27ae60; }
        .review-card.negative { border-left-color: #e74c3c; }
        .review-text { 
            line-height: 1.8; 
            font-size: 1.1em; 
            color: #444; 
            margin: 15px 0; 
            padding: 20px; 
            background: #f8f9fa; 
            border-radius: 10px; 
            border-left: 3px solid #3498db; 
            font-style: italic; 
        }
        .review-meta { 
            display: flex; 
            justify-content: space-between; 
            align-items: center; 
            margin-bottom: 15px; 
        }
        .sentiment-badge.positive { 
            background: linear-gradient(45deg, #27ae60, #2ecc71); 
            color: white; 
            padding: 5px 12px; 
            border-radius: 20px; 
        }
        .sentiment-badge.negative { 
            background: linear-gradient(45deg, #e74c3c, #c0392b); 
            color: white; 
            padding: 5px 12px; 
            border-radius: 20px; 
        }
        button { 
            padding: 12px 25px; 
            font-size: 1em; 
            margin: 10px 5px; 
            cursor: pointer; 
            border: none; 
            border-radius: 25px; 
            color: white; 
        }
        #runBtn { background: linear-gradient(45deg, #3498db, #2c3e50); }
        select {
            margin: 50px;
            width: 150px;
            padding: 5px 35px 5px 5px;
            font-size: 16px;
            border: 1px solid #CCC;
            height: 34px;
            -webkit-appearance: none;
            -moz-appearance: none;
            appearance: none;
            background: url(https://stackoverflow.com/favicon.ico) 96% / 15% no-repeat #EEE;
            }


            /* CAUTION: Internet Explorer hackery ahead */


            select::-ms-expand {
                display: none; /* Remove default arrow in Internet Explorer 10 and 11 */
            }

            /* Target Internet Explorer 9 to undo the custom arrow */
            @media screen and (min-width:0\0) {
                select {
                    background: none\9;
                    padding: 5px\9;
                }
            }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üéÆ Steam Review Sentiment Analysis</h1>
            <p>Game Review Analysis Dashboard</p>
        </div>

        <div style="padding: 20px;">
            <select id="app_id">
                <option value="315210">315210</option>
            </select>
            <!--<input type="number" id="app_id" placeholder="Enter Steam App ID">-->
            <button id="runBtn" onclick="runGetReviews()">üîç Run Sentiment Analysis</button>
            <div id="analysisStatus" style="margin-top: 10px; font-style: italic; color: #666;"></div>
        </div>

        <div id="liveResults" style="display:none; padding: 20px;">
            <h2>üìä Results</h2>
            <img id="visualization" src="" style="max-width:100%; margin-bottom: 20px; display:none;" />
            <div id="resultsContent"></div>
        </div>
    </div>

    <script>
        async function runGetReviews() {
            const status = document.getElementById('analysisStatus');
            const resultsDiv = document.getElementById('liveResults');
            const contentDiv = document.getElementById('resultsContent');
            const vizImg = document.getElementById('visualization');
            const appId = document.getElementById('app_id').value;

            if (!appId) { 
                status.innerHTML = '‚ùå Please enter a valid App ID!'; 
                return; 
            }

            status.innerHTML = '‚è≥ Running sentiment analysis on server...';
            resultsDiv.style.display = 'block';
            contentDiv.innerHTML = '‚è≥ Loading...';
            vizImg.style.display = 'none';

            try {
                const response = await fetch(`/analyze?app_id=${appId}`);
                const data = await response.json();
                console.log(data)

                if (data.error) {
                    status.innerHTML = '‚ùå ' + data.error;
                    contentDiv.innerHTML = '';
                    return;
                }

                status.innerHTML = '‚úÖ Analysis complete! Click into each review to analyse the sentiment!';

                // Show visualization
                // vizImg.src = data.visualization_path + '?t=' + new Date().getTime();
                // vizImg.style.display = 'block';

                let html = `<p><strong>App ID:</strong> ${data.app_id} | <strong>Total Reviews:</strong> ${data.total_reviews} | <strong>Timestamp:</strong> ${data.timestamp}</p>`;

                // Print out reviews
                html += `<h3 style="color: #00000;">Reviews</h3>`;
                data.reviews.forEach((review, index) => {
                     html += `<div class="review-card">
                                  <div class="review-meta">
                                      <span onclick="runSentimentAnalysis()" id="review_id" data-value="${index}">${review}</span>
                                  </div>
                              </div>`;
                })//<div class="review-text">${p.sentence}</div>


                // Most positive paragraphs
                // html += `<h3 style="color: #27ae60;">üåü Top Positive Paragraphs</h3>`;
                // data.most_positive_paragraphs.forEach(p => {
                //     html += `<div class="review-card positive">
                //                 <div class="review-meta">
                //                     <span class="sentiment-badge positive">üòä ${p.normalized_score.toFixed(3)}</span>
                //                 </div>
                //                 <div class="review-text">${p.sentence}</div>
                //             </div>`;
                // });

                // // Most negative paragraphs
                // html += `<h3 style="color: #e74c3c;">üíî Top Negative Paragraphs</h3>`;
                // data.most_negative_paragraphs.forEach(p => {
                //     html += `<div class="review-card negative">
                //                 <div class="review-meta">
                //                     <span class="sentiment-badge negative">üòû ${p.normalized_score.toFixed(3)}</span>
                //                 </div>
                //                 <div class="review-text">${p.sentence}</div>
                //             </div>`;
                // });

                contentDiv.innerHTML = html;

            } catch (error) {
                status.innerHTML = '‚ùå Error running analysis!';
                contentDiv.innerHTML = '<p style="color: #e74c3c;">‚ùå Failed to load results</p>';
                console.error(error);
            }
        }
        async function runSentimentAnalysis() {
            const reviewId = document.getElementById('review_id')
            const reviewIdVal = event.target.dataset.value;
            console.log(reviewIdVal)
            try {
                const response = await fetch(`/reviewId?review_id=${reviewIdVal}`);
                const data = await response.json();
                console.log(data)
            } catch (error) {
                console.error(error)
            }
        }
    </script>
</body>
</html>
