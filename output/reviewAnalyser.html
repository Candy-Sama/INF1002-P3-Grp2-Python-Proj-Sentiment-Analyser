<!DOCTYPE html> <!-- Created by Mus-->
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <!-- The Reason why the href is made that way is because it is using Flask's url_for function 
        to generate the correct URL for the static file -->
    <link rel="stylesheet" href="{{ url_for('static', filename='css/commonStyles.css') }}">
</head>
<body>
    <!-- Content for review analyzer will go here -->
    <div class="container">
        <div class="header">
            <h1>üîç Review Analyser</h1>
            <p>Detailed sentiment analysis for individual reviews</p>
        </div>
        <div style="padding: 20px;">
            {% if review_id is not none and app_id is not none %} <!-- Check if review_id and app_id are provided -->
                <div class="review-card">
                    <h3>Analysis Details</h3>
                    <p><strong>App ID:</strong> {{ app_id }}</p>
                    <p><strong>Review Index:</strong> {{ review_id }}</p>
                    <!-- Debug info -->
                    <p><strong>Debug - Review ID Type:</strong> {{ review_id.__class__.__name__ }}</p>
                    <p><strong>Debug - App ID Type:</strong> {{ app_id.__class__.__name__ }}</p>
                    <div id="reviewAnalysisContent">
                        <p>‚è≥ Loading detailed sentiment analysis...</p>
                    </div>
                </div>
                
                <div style="margin-top: 20px;"> 
                    <a href="/" style="text-decoration: none;">
                        <button class="backBtn">
                            ‚Üê Back to Main Analysis
                        </button>
                    </a>
                </div>
            {% else %} <!-- If review_id or app_id is missing -->
                <div class="review-card">
                    <p>‚ùå No review selected. Please go back and select a review to analyze.</p>
                    <a href="/" style="text-decoration: none;">
                        <button class="backBtn">
                            ‚Üê Back to Main Analysis
                        </button>
                    </a>
                </div>
            {% endif %}
        </div>
    </div>
    
    <!-- Load JavaScript at the end -->
    <script src="{{ url_for('static', filename='js/main.js') }}"></script>
    
    {% if review_id is not none and app_id is not none %}
    <script>
        // Wait for DOM to be ready, then call the function
        document.addEventListener('DOMContentLoaded', function() {
            // Pass Flask template variables to JavaScript (with safety checks)
            const reviewID = {{ review_id if review_id is not none else 'null' }};
            const appID = {{ app_id if app_id is not none else 'null' }};

            console.log('DOM loaded, starting analysis for review ID:', reviewID);
            console.log('App ID:', appID);
            
            // Check if values are valid before calling function
            if (reviewID !== null && appID !== null) {
                console.log('Calling updateReviewAnalysis with valid parameters');
                const timeoutId = updateReviewAnalysis("reviewAnalysisContent", appID, reviewID, 2000);
            } else {
                console.error('Invalid parameters - reviewID:', reviewID, 'appID:', appID);
            }
        });
    </script>
    {% endif %}
</body>
</html>